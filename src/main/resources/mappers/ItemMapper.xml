<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.todo.item.ItemMapper">

    <insert id="insItem" keyProperty="itemIndex" useGeneratedKeys="true">
        INSERT INTO item
        (item_title, board_index, item_position)
        SELECT #{itemTitle}, #{boardIndex}, IFNULL(MAX(item_position), 0) + 1
        FROM item
    </insert>

    <update id="updItemTitle">
        UPDATE item
        SET item_title = #{itemTitle}
        WHERE item_index = #{itemIndex}
    </update>

    <update id="updItemPositionTmp">
        UPDATE item
        SET item_position = #{newIndex}
        WHERE item_position = #{currentIndex}
    </update>
    <update id="updItemPosition">
        UPDATE  item
        SET
        <if test="newIndex > currentIndex">
            item_position = item_position - 1
            WHERE item_position > #{currentIndex} AND #{newIndex} >= item_position
        </if>
        <if test="currentIndex > newIndex">
            item_position = item_position + 1
            WHERE item_position >= #{newIndex} AND #{currentIndex} > item_position
        </if>
    </update>

</mapper>